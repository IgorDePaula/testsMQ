var amqp = require('amqp');
var conn = amqp.createConnection();
var schedule = require('../index')(conn);
conn.once('ready', function() {
  conn.queue('foobar', function(q) {
    q.subscribe(function(message) { console.log(new Date(), message); });
    var ex = conn.exchange('dead');
    ex.once('open', function() {
      q.bind(ex, 'foobar');
    });
  });
  var date = new Date(Date.now()+20*1000);
  // schedule('dead', 'foobar1s', { foobar: '1s after ' + new Date() }, 1000, { content_type: 'application/json' });
  // schedule('dead', 'foobar1m', { foobar: '1m after ' + new Date() }, 1000*60, { content_type: 'application/json' });
  // schedule('dead', 'foobar1h', { foobar: '1h after ' + new Date() }, 1000*60*60, { content_type: 'application/json' });
  // schedule('dead', 'foobar1d', { foobar: '1d after ' + new Date() }, 1000*60*60*24, { content_type: 'application/json' });
  // schedule('dead', 'foobar1mo', { foobar: '1m after ' + new Date() }, 1000*60*60*24*30, { content_type: 'application/json' });
  // schedule('dead', 'foobar1y', { foobar: '1y after ' + new Date() }, 1000*60*60*24*30*12, { content_type: 'application/json' });
  schedule('dead', 'foobar1w', { foobar: '1w after ' + new Date() }, 1000*60*60*24*30*12, { content_type: 'application/json' });
});

conn.on('error', function(err) {
	console.log( err );
});
